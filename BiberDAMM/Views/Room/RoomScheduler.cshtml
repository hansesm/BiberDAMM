@*
    View for displaying stay information
    Author: [HansesM]
*@
@model BiberDAMM.ViewModels.RoomSchedulerViewModel


@{
    ViewBag.Title = "RoomScheduler";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Raum Belegungsübersicht</h2>

<head>
    <title>Aufenthaltsdetails</title>
</head>

<div class="row">

    <div class="form-group col-md-12">
        @Html.Label("Raumtyp", new { @class = "col-form-label" })
        @Html.DropDownList("Bed", Model.ListRooms, new { @class = "form-control", id = "roomTypeDropDown" })
        @*@Html.DropDownList(model => model.Blocks.Bed.BedModels, BedModels.ListBedBedModelss, null, new { @class = "form-control" , id = "model"})*@
    </div>
</div>
<!-- row-->
<hr />

<div class="timetable"></div>

@section Scripts{
    <script>
        //var timetable = new Timetable();
        //timetable.setScope(6, 22);

        //timetable.addLocations(['Rotterdam', 'Madrid', 'Los Angeles', 'London', 'New York', 'Jakarta', 'Tokyo']);
        //console.log(['Rotterdam', 'Madrid', 'Los Angeles', 'London', 'New York', 'Jakarta', 'Tokyo']);

        //timetable.addEvent('Sightseeing', 'Rotterdam', new Date(2015, 7, 17, 10, 45), new Date(2015, 7, 17, 12, 30), '#');
        //timetable.addEvent('Zumba', 'Madrid', new Date(2015, 7, 17, 12), new Date(2015, 7, 17, 13), '#');
        //timetable.addEvent('Zumbu', 'Madrid', new Date(2015, 7, 17, 13, 30), new Date(2015, 7, 17, 15), '#');
        //timetable.addEvent('Lasergaming', 'London', new Date(2015, 7, 17, 17, 45), new Date(2015, 7, 17, 19, 30), '#');
        //timetable.addEvent('All-you-can-eat grill', 'New York', new Date(2015, 7, 17, 21), new Date(2015, 7, 18, 1, 30), '#');
        //timetable.addEvent('Hackathon', 'Tokyo', new Date(2015, 7, 17, 11, 30), new Date(2015, 7, 17, 20));
        //timetable.addEvent('Tokyo Hackathon Livestream', 'Los Angeles', new Date(2015, 7, 17, 12, 30), new Date(2015, 7, 17, 16, 15));
        //timetable.addEvent('Lunch', 'Jakarta', new Date(2015, 7, 17, 9, 30), new Date(2015, 7, 17, 11, 45), '#');

        //var renderer = new Timetable.Renderer(timetable);
    </script>

    <script>
        $(document).ready(function () {
            //Dropdownlist Selectedchange event
            $("#roomTypeDropDown").change(function () {

                    var timetable = new Timetable();
                    timetable.setScope(7, 20);
                    
                    var events = {};
                    events.url = "/room/GetSchedulerEvents";
                    events.type = "POST";
                    events.data = JSON.stringify({ roomTypeName: $("#roomTypeDropDown option:selected").text() });
                    //console.log(JSON.stringify({ end: $("#end").val(), begin: $("#begin").val(), model: $("#model option:selected").text(), roomType: $("#roomType option:selected").val() }));
                    events.dataType = "json";
                    events.contentType = "application/json";
                    events.success = function (roomTimeTableEvents) {

                        console.log(roomTimeTableEvents);

                        for (var i = 0; i < roomTimeTableEvents.length; i++) {
                            timetable.addEvent(roomTimeTableEvents[i].treatmentType,
                                roomTimeTableEvents[i].roomName,
                                new Date(roomTimeTableEvents[i].beginDate),
                                new Date(roomTimeTableEvents[i].endDate));
                        }

                        var renderer = new Timetable.Renderer(timetable);
                        renderer.draw('.timetable');

                    };
                    events.error = function () {
                        alert("Fehler beim Events abrufen!");
                    };


                    var rooms = {};
                    rooms.url = "/room/GetSchedulerRooms";
                    rooms.type = "POST";
                    rooms.data = JSON.stringify({ roomTypeName: $("#roomTypeDropDown option:selected").text() });
                    //console.log(JSON.stringify({ end: $("#end").val(), begin: $("#begin").val(), model: $("#model option:selected").text(), roomType: $("#roomType option:selected").val() }));
                    rooms.dataType = "json";
                    rooms.contentType = "application/json";
                    rooms.success = function (roomTimeTableRooms) {

                        timetable.addLocations(roomTimeTableRooms);
                        console.log(roomTimeTableRooms);

                        $.ajax(events);

                        };
                    rooms.error = function () {
                        alert("Fehler beim Räume abrufen!");
                    };
                    
                    $.ajax(rooms);
                    
                });
            });
    </script>
}
